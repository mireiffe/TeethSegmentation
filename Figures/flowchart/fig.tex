\begin{figure}
	\newcommand*{\algvgap}{1.8}%
	\newcommand*{\segvgap}{0.45}%
	\newcommand*{\midgap}{1.4}%
	\newcommand*{\algminwid}{2.8}%
	\newcommand*{\algminhei}{1.1}%
	\newcommand*{\minwid}{2}%
	\newcommand*{\minhei}{1.7}%
	\centering
	\begin{tikzpicture}[font=\normalsize, thick, node distance=1.5cm and 1.5cm, scale=0.8, every node/.style={scale=0.75}]
	\tikzstyle{inter} = [
		draw,
		trapezium, 
		trapezium left angle = 65,
		trapezium right angle = 115,
		trapezium stretches,
		minimum width=\minwid cm,
		minimum height=\minhei cm,
		align=center,
		text width=0.7*\minwid cm,
		fill=blue!20
		]
	\tikzstyle{io} = [
		draw,
		rounded rectangle,
		minimum width=.8*\minwid cm,
		minimum height=\minhei cm,
		text width=.8*\minwid cm,
		align=center,
		fill=red!30
		]
	\tikzstyle{proc} = [
		draw,
		minimum width=\minwid cm,
		minimum height=\minhei cm,
		text width=\minwid cm,
		align=center,
	    fill=orange!20,
		]
	\tikzstyle{alginter} = [
		draw,
		trapezium, 
		trapezium left angle = 65,
		trapezium right angle = 115,
		trapezium stretches,
		minimum width=\algminwid cm,
		minimum height=\algminhei cm,
		align=center,
		text width=0.7*\algminwid cm,
		fill=blue!20
		]
	\tikzstyle{algproc} = [
		draw,
		minimum width=\algminwid cm,
		minimum height=\algminhei cm,
		text width=\algminwid cm,
		align=center,
	    fill=orange!20,
		]
		
	%segmentation
	\node [io,
		% below=0.8*\segvgap cm of title_b,
		] (input) at (-3, -4.5) {Teeth\\image};

	\node [inter,
		right=\segvgap cm of input,
		] (dnn) {Deep\\neural\\network};

	\node [inter,
		right=\segvgap cm of dnn,
		] (per) {Pseudo edge-region};

	\node [proc,
		right=\segvgap cm of per,
		] (ac) {Active contour models};

	\node [inter,
		right=\segvgap cm of ac,
		] (regions) {Segmented regions};
		
	\node [proc,
		right=\segvgap cm of regions
		] (id) {Region\\identification};
		
	\node [io,
		right=\segvgap cm of id,
		] (res) {Result};
		
	% labeling
	\node [alginter,
	% above=2.3*\midgap cm of input,
		] (image) at (-3 + .5*\algminwid - .5*\minwid-.05, 0) { Teeth image };
	
	\node [algproc,
		above=0.75*\algvgap cm of dnn,
		] (train) {Training};

    \node [algproc,
		right=\algvgap cm of image,
		] (ome) {$\ome$ from GADF};

	\node [algproc,
		right=\algvgap cm of ome,
		] (selection) {{Manual selection} \\ {\& dilation}};

	\node [alginter,
		right=\algvgap cm of selection,
		] (label) {Label};

	% Arrows
	\draw[thick,-latex] (image) edge (ome)
		(ome) edge (selection)
		(selection) edge (label)
		(train) edge (dnn);

	\draw[thick,-latex] (input) edge (dnn)
		(dnn) edge (per)
		(per) edge (ac)
		(ac) edge (regions)
		(regions) edge (id)
		(id) edge (res);

	\draw[thick,-latex] (image) |- (train);
	\draw[thick,-latex] (label) |- (train);
	
	\node [draw,
		minimum width=3cm,
		minimum height=1.0cm,
		fill=white,
		above=.20*\midgap cm of ac
		] (title_b) {\textbf{(b) Segmentation}};
	
	\node [draw,
		minimum width=3cm,
		minimum height=1cm,
		above=1.85*\midgap cm of title_b,
		fill=white
		] (title_a) {\textbf{(a) Data labeling and training}};
	
	\begin{scope}[on background layer]
		\draw[black,line width=.4mm,dashed] ($(title_a.west)+(-6.65,0)$)  rectangle ($(title_a.west)+(-6.65,0)+(18.2,-8*\segvgap)$);
		\draw[black,line width=.4mm,dashed] ($(title_b.west)+(-7.7,0)$)  rectangle ($(title_b.west)+(-7.7,0)+(18.2,-6.3*\segvgap)$);
	\end{scope}
  \end{tikzpicture}
  \caption{Algorithm flowchart: (a) Data labeling and training process. (b) Segmentation process. }
  \label{Fig:flowchart}
\end{figure}