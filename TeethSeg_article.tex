\documentclass[10pt]{article}
\usepackage[utf8]{inputenc}
\usepackage{geometry} % to change the page dimensions
\geometry{a4paper}
\usepackage{authblk}

%% Packages
\usepackage{graphicx, subcaption}
\usepackage{amsmath,amssymb,amsthm,amsfonts}
\usepackage{bm}
\usepackage{algorithm, algorithmic}
\usepackage{multirow}
\usepackage{bbm}
\usepackage{hyperref,url}
\usepackage{kotex}
\usepackage[bottom]{footmisc}
\usepackage[labelformat=simple]{subcaption}

\usepackage{tikz}
\usetikzlibrary{shapes, arrows.meta, positioning, calc, arrows, backgrounds}

\captionsetup[figure]{labelsep=period}
% \renewcommand{\thefigure}{\Roman{figure}}
% \captionsetup[subfigure]{labelformat=parens} % default is 'parens'
% \renewcommand{\thesubfigure}{\thefigure.\alph{subfigure}.}
\renewcommand\thesubfigure{(\alph{subfigure})}

%% Theorems
\theoremstyle{plain}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{lemma}[theorem]{Lemma}

\theoremstyle{remark}
\newtheorem{remark}[theorem]{Remark}
\newtheorem{example}[theorem]{Example}

\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}

%% Equations
\numberwithin{equation}{section}

%% Algorithms
\renewcommand\algorithmicdo{}
\renewcommand\algorithmicthen{}
\renewcommand\algorithmicendfor{\textbf{end}}

%% Macros
\def\chfun{\mathbbm{1}}
\def\calc{\mathcal{C}}
\def\endske{E\left(\mathcal{S}^8\right)}
\def\endomc{E\left(\Omega_c\right)}


\def\gphi{\nabla\phi}
\def\gphii{\nabla\phi_i}
\def\ngphi{\left|\nabla\phi\right|}
\def\ngphii{\left|\nabla\phi_i\right|}

\def\fci{F_{c,\,i}}
\def\fcj{F_{c,\,j}}

\def\fsi{F_{s,\,i}}

\def\cm{\, ,}
\def\pd{\, .}

\def\omi{\Omega_i}
\def\oma{\Omega_a}
\def\ome{\Omega_E}
\def\oms{\Omega_S}
\def\omc{\overline{\Omega}_P}
\def\omcc{\Omega_P}
\def\omt{\Omega_T}
\def\omn{\Omega_N}

\def\ER{\mathcal{R}}
\def\PER{\mathcal{P}}
\def\ERC{\Omega \setminus \ER}

\def\opp{\Omega_{\phi_i}^+}
\def\opn{\Omega_{\phi_i}^-}
% \def\opo{\Omega_{\phi}^0}
\def\opo{C_{\phi_i}}

\def\sdf{\mbox{\textrm{sdf}}}

\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\argmin}{arg\,min}
% \def\tOmega{\tilde{\Omega}}
% \def\tGamma{\tilde{\Gamma}}
% \def\tV{\tilde{V}}
% \def\W{\mathbb{W}}
% \def\tu{\tilde{u}}
% \def\bu{\bar{u}}
% \def\hu{\hat{u}}
% \def\bl{\bar{\lambda}}
% \def\p{\mathbf{p}}
% \def\P{\mathbf{P}}
% \def\intO{\int_{\Omega}}
% \def\intOs{\int_{\Omega_s}}
% \def\m{\mathbf{m}}
% \def\n{\mathbf{n}}
% \def\blambda{\bm{\lambda}}

% \def\tE{\tilde{E}}
% \def\N{\mathcal{N}}

% \def\div{\mathrm{div}}
% \def\proj{\mathrm{proj}}
% \def\prox{\mathrm{prox}}
% \def\ran{\mathrm{ran}\,}
% \def\ed{\mathrm{ed}}
% \def\supp{\mathrm{supp}\,}
% \def\TOL{\mathrm{TOL}}
% \DeclareMathOperator*{\argmin}{\arg\min}

% Text Color and Strike
\usepackage[normalem]{ulem}
\usepackage{color}
\newcommand{\red}[1]{{\color{red}{#1}}}
\newcommand{\blue}[1]{{\color{blue}{#1}}}
\newcommand{\blfootnote}[1]{%
  \begingroup
  \renewcommand\thefootnote{}\footnote{#1}%
  \addtocounter{footnote}{-1}%
  \endgroup
}

\title{ Individual Tooth Segmentation in Human Teeth Images Using Pseudo Edge-Regions Obtained by Deep Neural Networks }
\author{Seongeun Kim and Chang-Ock Lee}
\affil{Department of Mathematical Sciences, KAIST, Daejeon 34141, Korea}
\date{ }

\begin{document}
\maketitle

\begin{abstract}
In human teeth images taken outside the oral cavity with a general digital camera, it is difficult to segment individual tooth due to common obstacles such as weak edges, intensity inhomogeneities and strong light reflections. In this work, we propose a method for segmenting individual tooth in human teeth images. The key to this method is to obtain pseudo edge-regions using deep neural networks. After an additional step to obtain initial contours for each tooth region, the individual tooth are segmented by applying an active contour model. We also present a strategy using existing model-based methods for labeling the data required for neural network training.~{\blfootnote{This work was supported by the National Research Foundation~(NRF) of Korea grant funded by the Korea government (No.~2020R1A2C1A01004276).}}
\end{abstract}

{\small \textbf{Key words}
Tooth segmentation, Neural network, Geometric attraction-driven flow, Edge-region, Light reflection}

{\small \textbf{AMS subject classifications}
68T07, 94A08}

%% Main text starts ---------------------------------------------------------------------------------------------------

% Section: Introduction
\section{Introduction}
\label{Sec:Introduction}

Image segmentation is one of major topics in the field of computer vision. The main goal of image segmentation is to segment objects in an image according to a specific purpose and many outstanding methodologies have been developed. The active contour model is one of the popular methods for the image segmentation and boundary detection. It makes contours move to the boundary of the nearby object~\cite{Kass:1988:Snakes}; gradient vector flows (GVF)~\cite{Xu:1997:GVF} and geodesic active contours (GAC)~\cite{Caselles:1997:GAC} are well-known models with different moving forces. In \cite{Chan:2001:chanvese}, a region-based active contour method was proposed unlike the previous methods using edge maps.

Segmentation of individual tooth in human teeth images has been mainly performed on computed tomography~(CT) or X-ray images~\cite{Yuan:2020:teethParanomic,Naumovich:2015:teethCT3D,Said:2006:teethxray,Shah:2006:teethautoseg}. In these images, teeth are easily segmented  because the intensity of the tooth region is much stronger than that of the gums or tissues. However, segmenting individual tooth in a teeth image taken outside the oral cavity with a general digital camera is a more difficult problem. In the teeth images, not only weak edges and light reflections appear, but also colors and illuminance are inhomogeneous due to plaque and oral structure, which are major obstacles to segmentation of individual tooth. Several attempts have been made to segment individual tooth in teeth images. In~\cite{Na:2014LteethMorph}, the watershed algorithm~\cite{Vincent:1991:watershed} with color information was proposed. Recently, segmentations using supervised learning methods have been mainly performed. In~\cite{WU:2016}, a supervised learning method BEL~\cite{Dollar:2006:BEL} was used to obtain the individual tooth boundaries, and in~\cite{Kim:2020,Pham:2020,Zhu:2020:teethMaskrcnn}, deep learning methods based on Mask R-CNN~\cite{He:2018:MRCNN} were proposed. Although model-based methods are reliable, they produce poor results when applied to images obtained in an unrefined environment. On the other hand, it is well known that supervised learning methods can give excellent results for a variety of images, but require a sufficient amount of training data for stable performance, and the labeling process of training data takes a lot of time and cost.

The main applications of individual tooth segmentation are reconstruction of 3D teeth models, identification of deceased persons~\cite{Pretty:2001:forensic}, and dental healthcare. The 3D teeth model reconstruction was developed based on individual tooth segmentation in CT images~\cite{Yuan:2020:teethParanomic,Naumovich:2015:teethCT3D}. However, in a recent study~\cite{WU:2016}, a 3D teeth model reconstruction method using individual tooth boundaries in a single teeth image was proposed. The identification of deceased person is one of the most important task in forensic dentistry~\cite{Shah:2006:teethautoseg}. This is established by comparison of antemortem and postmortem dental records~\cite{Pretty:2001:forensic}, and an individual tooth segmentation is necessary to automate this process.

In this paper, we segment individual tooth regions using a deep neural network and an active contour model. First, we obtain pseudo edge-region using the deep neural network. After that, an active contour model using multiple contours is applied to obtain initial contours, and then regions are segmented from the pseudo edge-region. Finally, it identifies tooth regions and regions without teeth, resulting in only the tooth region. When preparing data for training the neural network, we manually select regions on the tooth boundary among the edge-regions acquired by the geometric attraction-driven flow (GADF). This greatly reduces the time and cost of the data labeling process compared to performing the entire process manually.

The remainder of this paper is organized as follows. In Section~\ref{Sec:er_teeth}, we will discuss GADF, edge-regions, and problems of edge-regions obtained from teeth images. In Section~\ref{Sec:PM}, the proposed algorithm is described, and the experimental results are presented in Section~\ref{Sec:result}. We will conclude this paper in Section~\ref{Sec:Conclusion}. 

% Sec:Background
\section{GADF, edge-regions, and segmentation}
\label{Sec:er_teeth}

In this section, we briefly review the GADF, edge-region in~\cite{Hahn:2006,Hahn:2010:GADF}, and active contour models, which play key roles in segmenting individual tooth. Then we will show that the edge-regions obtained by GADF are incomplete due to the problematic features of the teeth image.

% Subsec:GADF
\subsection{GADF}
\label{Subsec:GADF}
Let $I\colon\Omega\subset\mathbf{R}^2\rightarrow[0,\,1]$ be a given smooth gray image. The image intensity changes rapidly on the boundary of objects in the image. Thus, a point $x\in\Omega$ is defined as an edge point if
\begin{align*}
    u_x''(0)=0\cm %label{Def:edge}
\end{align*}
where
\begin{align*}
    u_x(s) = I\left( x + s\frac{\nabla{I(x)}}{|\nabla{I(x)}|} \right)\pd
\end{align*}
In \cite{Hahn:2010:GADF}, the GADF is defined as
\begin{align}
    F_a(x) = \mbox{sgn}(\ell(x))\frac{\nabla I(x)}{\left|\nabla{I(x)}\right|},\quad \forall{x}\in\Omega\cm  \label{Def:gadf}
\end{align}
where $\mbox{sgn}$ is the sign function and
\begin{align*}
    \ell(x) &= \int^{\epsilon}_{0} {u'_x(s)}\,ds - \int^{0}_{-\epsilon} {u'_x(s)}\,ds\quad\mbox{for a small}~\epsilon > 0\pd
\end{align*}
By the definition, $F_a(x)$ points along the line $x + s\frac{\nabla{I(x)}}{|\nabla{I(x)}|}$ towards the edge point. The GADF can be naturally extended to color images; see~\cite{Hahn:2006,Hahn:2010:GADF}. However, in this paper, we consider the GADF only for grayscale images obtained by averaging channels of a given color image.

% Subsection: Edge-regions
\subsection{Edge-regions}
\label{Subsec:edge-regions}

The edge-region is roughly defined as the union of thin regions containing most of object boundaries, regardless of the strength of edges. In~\cite{Hahn:2010:GADF}, $\ome$ is defined as a region where $F_a$ faces each other, i.e.,
\begin{align*}
    \ome = \left\{ x\in\Omega \mid F_a(x^*) \cdot F_a(x) < 0 ~\mbox{and}~ x^*=x+F_a(x) \right\}\pd %\label{Def:pre_er}
\end{align*}
Since $F_a$ is defined using normalized image gradient, it is independent of the strength of edges so that $\ome$ satisfies the rough definition of the edge-region. But in practice, $\ome$ is just a candidate for the edge-region, because it contains many regions that are not intersected with the boundaries of the object. Hence, it is necessary to remove them as many as possible.

In Figure~\ref{Fig:edge_regions}, there are three teeth images: a synthetic image and two real teeth images. In the case of the synthetic image, $\ome$ is well formed only at the tooth boundary, but in the teeth images, there are a lot of regions that do not intersect with the tooth boundaries. Among the connected components of $\ome$, those that are small in size or formed in flat regions are removed assuming that they do not contain tooth boundaries~\cite{Hahn:2006}. In the rightmost column, the edge-region $\oma$ is presented, which is obtained through such removal process from $\ome$. Despite these efforts, there are still many regions that are not intersected with the tooth boundary in the refined edge-regions; see the bottom right of Figure~\ref{Fig:edge_regions}. We will address this issue in the next two sections.

% Figure: Weak edges in teeth image
\input{ ./Figures/edge_region/fig.tex}

% Subsection: Active Contour Models
\subsection{Active contour model}
\label{Subsec:active_contour}

We consider a contour evolution in~\cite{Hahn:2010:GADF} using the GADF $F_a$~\eqref{Def:gadf} with the binary balloon force $F_b$ in the level set formulation:
\begin{align}
    \begin{split}
    \frac{\partial}{\partial{t}}\phi(x,\,t) &= \mu\kappa(\phi)\left|\nabla\phi\right| + \chi_{\Omega_b}F_b|\nabla\phi| - \chi_{\oma}F_a\cdot\nabla\phi\cm\\
    \phi(x,\,0) &= \phi_0(x)\cm
    \end{split} \label{Eq:ac_gadf}
\end{align}
where $\mu$ is a constant, $\kappa(\phi)$ is the curvature of $\phi$, $\phi_0$ is the initial signed distance function (SDF), and $\chi$ is a characteristic function of the subscripted set. Here, $\oma$ is an edge-region, and $\Omega_b = \Omega\setminus\oma$. By \eqref{Eq:ac_gadf}, the initial contour moves outward in $\Omega_b$ by the binary balloon force $F_b$ and, once entering $\oma$, reaches the edge along $F_a$.

In Figure~\ref{Fig:evolution}, using the edge-region at the bottom of Figure~\ref{Fig:edge_regions_4}, the contours evolved by~\eqref{Eq:ac_gadf} with different initial positions are presented over time. As the contour evolves, the edge-regions interfere the movement of the contour. There are two types of edge-regions: closed shape and non-closed shape. For the region that does not form a closed shape, evolving contours can invade the region from the ends and then encroach on the region. On the other hand, like a barrier, closed-shaped edge-regions block the movement of the contour sometimes stopping the contour at the place other than the object boundary, resulting in incorrect segmentation.

% Figure: Edge regions outside the tooth boundaries
\input{ ./Figures/evolution/fig.tex}

% Subsection: Light reflections in the teeth image
\subsection{Light reflections in teeth images}
\label{Subsec:light_reflection}

As discussed in Sections~\ref{Subsec:edge-regions} and \ref{Subsec:active_contour}, there are bad regions in the edge-regions, that prevent the active contours from reaching near the boundary of objects. In the case of teeth images, closed-shaped edge-regions caused by strong light reflection in the teeth and gums mainly become such bad regions. Since light reflection is accompanied by strong intensity jumps and irregular shapes, it is difficult to remove the edge-regions due to the reflection with simple method such as those mentioned in Section~\ref{Subsec:edge-regions}.

One way to prevent these regions is to remove light reflection from the teeth image. There have been several studies to remove light reflection in a single image~\cite{SpecRemoval:2018,SpecRemoval:2020,SpecRemoval:2016,SpecRemoval:2015}. In these works, an image was decomposed into a non-reflective image and a reflection map in the image domain. These methods are based on the intensity histogram or assumption of a dichromatic image model~\cite{Shafer:1985:colorsep} using color information of the reflective region. However, in the case of teeth images, the colors of the light reflection and the tooth surface are almost the same due to the characteristics of human tooth. For this reason, when these methods are actually applied, parts of the tooth surface is also removed along with the light reflection. 

Although there was an attempt to remove the light reflection in teeth images using a single layer perceptron \cite{LeeRemoval:2010}, there is a limitation that it cannot be applied to a wide range of images because the perceptron has an extremely simple structure and learning is processed with only one image.

The most problematic thing is that even if light reflection is removed from the teeth image, individual tooth cannot be segmented immediately. This is because there are many factors such as stain or noise other than light reflection that create unnecessary edges. Each is simple and does not interfere with the movement of the contour, but if they stick together to form a large bunch or enclosed a region, it hinders the movement of the contour and becomes an obstacle to detecting the boundary of the tooth. In addition, when light reflection appears on the tooth boundary, the edge collapses when the light reflection is removed, so that the boundary becomes undetectable. Therefore, we seek a way to directly obtain only the edge-region near the tooth boundary, regardless of stains, noise or light reflection of the image. To this end, a supervised learning method with deep neural networks is considered.

% Section: Proposed Method
\section{Proposed Method}
\label{Sec:PM}
In this section, we describe the steps of the proposed individual tooth segmentation algorithm. It has the following three main steps and the whole process is shown in Figure~\ref{Fig:flowchart}:

\begin{itemize}
\setlength{\itemindent}{5mm}
    \item[STEP 1] Obtaining pseudo edge-region from a neural network,
    % \item[STEP 2] Acquiring initial contours using morphological characteristics of teeth regions,
    \item[STEP 2] Segmentation using active contours with initial contours acquired from the pseudo edge-region,
    \item[STEP 3] Identification of tooth and non-tooth region.
\end{itemize}

% Figure: Algorithm flowchart
\input{ ./Figures/flowchart/fig.tex}
    
% Subsection: Obtaining pseudo edge-regions from a neural network
\subsection{Obtaining pseudo edge-region from a neural network}
\label{Subsec:pseudo_er}

As shown in Figure~\ref{Fig:flowchart}(a), we make labels for training data using GADF and manual selection. First, we manually select the connected components of $\ome$ intersecting the tooth boundary, then the label $Y\colon\Omega\subset\mathbf{R}^2\rightarrow\{0,\,1\}$ is defined as a binary image
\begin{align*}
    Y(x) =
    \begin{cases}
        1 & x\in\oms\cm\\
        0 & \mbox{otherwise}\cm
    \end{cases}
\end{align*}
where $\oms$ is obtained by dilating the regions manually selected from $\ome$ using an $\eta\times\eta$ square structuring element with the origin at its center. In Figure~\ref{Fig:labeling}, the labeling process is presented.

We consider a neural network consisting of the part of ResNeSt-50~\cite{Zhang:2020:ResNeSt} before the global average pooling as the encoder part and a custom upscaling module as the decoder part. The network takes a three channel image $X\colon\Omega\rightarrow\mathbf{R}^3$ as an input and produces an image $\hat{Y}\colon\Omega\rightarrow(0,\,1)$ as an output and is trained by minimizing the binary cross entropy (BCE) loss function~\cite{Zhang:2018:BCE} of $Y$ and $\hat{Y}$. The entire network structure is shown in Appendix~\ref{App:neural_net}.

% Figure: Labeling images
\input{ ./Figures/labeling/fig.tex}

The network output $\hat{Y}(x)$ can be thought as the probability map that an edge-region caused by the tooth boundary exists at $x$. We call
\begin{align*}
    \PER = \delta_\theta\left( \PER_0 \right)
\end{align*}
as a pseudo edge-region of $X$ where
\begin{align*}
    \PER_0 = \left\{ x\in\Omega \mid \hat{Y}(x) > 0.5 \right\} \cm %\label{Def:per0}
\end{align*}
and $\delta_\theta$ is successive dilation and erosion by a $\theta \times \theta$ square structuring element with $\theta=\max\{\lfloor \omega / 1.5 + 0.5 \rfloor, 1\}$ and $\omega$ is the average thickness of $\PER_0$. Examples of pseudo edge-regions for teeth images are shown in the first two rows of Figure~\ref{Fig:pre_er}. One notable point is that the pseudo edge-region obtained by the neural network look better than the regions obtained by the manual selection from $\ome$.

% Figure: pre_er
\input{ ./Figures/per_init/fig.tex}

% Subsection: Acquiring initial contours and segmentation using active contours
\subsection{Segmentation using active contours}
\label{Subsec:SegLevelset}

In this section, we propose two successive active contour models formulated by the level set method. Resulting contours from the first active contour model are used for initial contours of the second active contour model. We denote $\sdf(A)$ as the SDF which is negative in the set $A$ and constantly zero on $\partial A$.

\subsubsection{The first active contour model}
\label{Subsec:first_ac}

If the pseudo edge-region perfectly matches the tooth boundaries, all tooth regions are surrounded by thin regions, so they are naturally separated. However, there are often leakages in the pseudo edge-region, which does not enclose the tooth region. Thus, multiple objects may be linked into a single region, in which case each object must be separated. Let $\mathcal{S}$ be such a single region. For each local minimum of $\sdf(\mathcal{S})$, by taking boundary of set where $\sdf(\mathcal{S})$ is less than the half of the minimum value, we can obtain initial contours for each linked object in $\mathcal{S}$; see the third row of Figure~\ref{Fig:pre_er}. 

In order to get better initial contours for the second active contour model, each contour is expanded to touch the pseudo edge-region. For a collection $\{\phi_i\}$ of level set functions, the competing balloon force $\fci$ is defined as
\begin{align}
    \fci(x,\,t) =
        -1 - \sum_{j\neq i}\min\left(\phi_j(x,\,t) - 1,\,0\right)\cm \label{Def:CompeteBalloon}
\end{align}
which is designed to inflate the zero level set $\{\phi_i = 0\}$ until it meets $\{\phi_j = 0\}$ for any $j\neq i$ and then stop. Here, a contour evolution using the competing balloon force is proposed
\begin{align}
    \begin{split}
        \frac{\partial}{\partial{t}}\phi_i(x,\,t) &= \mu\kappa(\phi_i)\ngphii + \chi_{\Omega\setminus\PER}\fci\ngphii +\nu\chi_{\PER}\ngphii\cm\\
        \phi_i(x,\,0) &= \phi_{i}^{F}(x)\cm
    \end{split}\label{Eq:evolv_init}
\end{align}
where $\mu$, $\nu$ are constants, $\kappa(\phi_i)$ is the curvature of $\phi_i$, $\PER$ is the pseudo edge-region, and $\phi_i^F$ is SDFs representing initial contours obtained before. The first term is a regularization term, and the second term makes contour $\phi_i$ stop when it meets the zero level sets of other $\phi_j$ including $\phi_0$. The third term prevent the contour to enter $\PER$. 

In initial contours, the distance from each contour to $\PER$ are all different. In order to ensure that all contours reach $\PER$ at the same time, a standby process is introduced when applying the evolution~\eqref{Eq:evolv_init}; contours that have reached a certain range of $\PER$ stop and wait until all the contours reach the range. If all contours reach the range, then they continue to evolve. In this process, until all contours reach a certain range of $\PER$, contours that touch each other are merged rather than stopped by $\fci$ to reduce the over-segmentation. Contours in standby and resulting contours are shown in the last two rows of Figure~\ref{Fig:pre_er}.

\subsubsection{The second active contour model}
\label{Subsec:second_ac}

Now, we segment each region using contours found in the previous section. Let $\left\{\phi_{i}^S\right\}_{i=1}^{N}$ be a collection of level set functions which are steady-state solutions of~\eqref{Eq:evolv_init}. Here, we assume that $\PER$ contains the tooth boundaries and let $\ER$ be edge-region candidate intersecting $\PER$, i.e., $\ER=\PER\cap\ome$. Since the contours are touching $\partial\PER$, we will push $\phi_{i}^S$ outward until it reaches the boundary of the tooth. For this, we propose a contour evolution with a level set formulation:
\begin{align}
    \begin{split}
        \frac{\partial}{\partial{t}}\phi_i(x,\,t) &= \mu\kappa(\phi_i)\ngphii + \chi_{\ERC}\left( \fci + {\fsi} \right) \ngphii-\chi_{\ER}F_a\cdot \gphii \cm \\
        \phi_i(x,\,0) &= \phi_{i}^S(x)\cm
    \end{split} \label{Eq:proposed}
\end{align}
where $\mu$ is a constant, $\kappa(\phi_i)$ is the curvature of $\phi_i$. Here are three forces $F_a$,~$\fsi$ and $\fci$; $F_a$ is the GADF defined in~\eqref{Def:gadf} and $\fci$ is the competing balloon force~\eqref{Def:CompeteBalloon}. The force $\fsi$ is called the statistically reinstating force~(SRF) proposed in~\cite{Park:2014:SRM}. It examines the intensity distributions of local regions inside and outside of a given contour and assign $1$ or $-1$ to move the contour so that the point on the contour belongs to the region with more similar intensity.

When a contour $\calc$ evolves by~\eqref{Eq:proposed}, the first term controls the smoothness of $\calc$, and other terms control the movement of the contour. When $\calc$ is in $\ER$, it is only affected by the third term that attracts $\calc$ to the boundary of a tooth. On the other hand, when $\calc$ is in $\ERC$, the contour is affected by the second term. We consider two cases according to the relation between $\calc$ and other contours. Let a point $x$ be in $\calc$. In the case that $x$ is away from the other contours, $\fci=-1$ so that the second term of~\eqref{Eq:proposed} becomes ${\fsi} - 1$. If $\fsi(x)=-1$, then the second term becomes $-2$, hence, $\calc$ moves outward. But if $\fsi(x)=1$, the second term becomes $0$ and $\calc$ stops. In the case that $x$ is close to other contours, then $\fci$ becomes $0$ and $\calc$ is affected by $\fsi$. Thus the contour moves following the SRF~\cite{Park:2014:SRM}. In Figure~\ref{Fig:proposed}, we can see how contour moves differently under different situations.

% Figure: proposed evolution
\input{ ./Figures/proposed/fig.tex}

% Subsection: Teeth and non-teeth region classification
\subsection{Identification of tooth and non-tooth regions}
\label{Subsec:regClass}

As a final step, the identification of the segmented regions remains. Since our goal is to segment each individual tooth, we need to identify tooth regions, and exclude non-tooth regions from the result in Section~\ref{Subsec:SegLevelset}. In a human teeth image, tooth and non-tooth regions can be easily distinguished by analysis of colors.

First, the teeth enhanced map $G/R-\alpha B$ was proposed in consideration of the ratios of $R$, $G$ and $B$ values: Teeth are white or ivory in color, and thus both of $R$ and $G$ channels have similar values on there. Therefore, the value of $G/R$ is close to $1$ in teeth and close to $0$ in reddish parts such as gums and lips. However, $G/R$ emphasizes not only teeth but also light reflection. Light reflections are usually whiter than teeth so that $B$ values are larger in there than in teeth. Thus, by subtracting values proportional to $B$, the emphasis of the light reflection can be lowered. Second, among the regions segmented in Section~\ref{Subsec:SegLevelset}, those containing more than 25\% of pixels with values smaller than the average in the teeth enhanced map are removed. Examples of teeth enhanced map are shown in Figure~\ref{Fig:tem}.

% Figure: teeth enhanced map
\input{ ./Figures/TEM/fig.tex}

% Section: Experimental results
\section{Experimental results and numerical aspect}
\label{Sec:result}

\textbf{Parameters and Numerical schemes.} In Section~\ref{Subsec:pseudo_er}, $\eta=\lfloor|\Omega| / 600 + 1/2\rfloor$. In all experiments, the parameters $\mu=2$ and $\nu=0.5$ are used in~\eqref{Eq:evolv_init}, and $\mu=2$ in~\eqref{Eq:proposed}. The finite difference scheme is applied to approximate all derivatives. For contour evolutions, the explicit Euler method is used, and the time increment was set as 0.3 in all cases. While performing the contour evolutions, the level set function is frequently reinitialized by the method in~\cite{SUSSMAN:1994}. 

\noindent\textbf{Dataset and data augmentation.} The training dataset consists of $46$ images in~\cite{T000,T001,T002,T003,T004,T005,T006,T007,T008,T009,T010,T011,T012,T013,T017,T018,T019,T020}. All teeth images contain light reflections on the surface of teeth, gums and other parts. 

To get more diverse training data, data augmentation is applied. In each epoch, images are resized with randomly sampled heights in $[256,\, 512]$ by keeping vertical and horizontal ratio. After that, a $256\times256$ patch is randomly cropped from either the resized image or its horizontal flip~\cite{He:2015:ResNet,Krizhevsky:2012:ImageNet}. For each cropping, the additional augmentation in the following list is randomly applied with the probability $0.5$. The parameters are uniformly selected within the given ranges:
\begin{itemize}
    \item Gaussian smoothing with $\sigma\in[0.25,\,0.75]$,
    \item Adding Gaussian noise with $\sigma\in[0.005,\,0.015]$,
    \item Gamma correction with $\gamma\in[0.5,\,2]$.
\end{itemize}

\noindent\textbf{Training.} The neural network is trained by minimizing the BCE loss function \cite{Zhang:2018:BCE} using the Adam optimizer \cite{Kingma:2017}. The exponential decay rates for the moment of Adam optimizer are set to $(\beta_1,\,\beta_2)=(0.9,\,0.999)$ and the learning rate is $0.005$. Network is trained for $10{,}000$ epochs with $46$ iterations for each epoch, and the parameters after the last epoch are selected. 

It seems that the number of epochs is excessive compared to those that are usually chosen, but in fact it is not. For each image, there are at least $16$ image variants that can be obtained with data augmentation, even excluding patch cropping and resizing. Since the parameters of each data augmentation are randomly selected each time and randomly selected patches from random size images are used, it is comparable to typical $100$ epochs.

\noindent\textbf{Results.} In Figure~\ref{Fig:results}, several teeth images with segmentation results for existing and proposed methods are presented. The results of the modified watershed algorithm (MWA) that is a model-based method~\cite{Na:2014LteethMorph} are in Figure~\ref{Fig:na2014}. The parameters used in MWA could not be obtained from~\cite{Na:2014LteethMorph}, so they were selected with our best effort. Many wrong results, such as captured light reflection or mis-segmented tooth boundaries, appear in the results in~\ref{Fig:na2014}. Figures~\ref{Fig:mrcnn} and~\ref{Fig:mrcnn_w} show the results using the methods based on Mask R-CNN~\cite{He:2018:MRCNN,Pham:2020,Zhu:2020:teethMaskrcnn}. For training, we used the same training dataset as in this paper and all training strategies were followed exactly as in each paper~\cite{Kim:2020,Zhu:2020:teethMaskrcnn}. Mask R-CNN requires individual tooth regions as labels, which were generated through a well-known labeling tool, Labelme~\cite{Russell:2007:labelme}.

Figure~\ref{Fig:ours} shows the results of our proposed algorithm. As shown in the figure, the methods used in the last three columns of Figure~\ref{Fig:results} all show remarkable results. The two results of Mask R-CNN look similar but, our results are distinct from the two results. A few differencces can be observed; Since the results with Mask R-CNN are pixel-based segmentation, the segmenting lines appear stepwise along the pixels and gaps with the actual teeth occur as well. Meanwhile, because our method uses level sets, the segmenting lines are smooth and fit well with the atual teeth. Finally, Mask R-CNN shows relatively poor capture of the outermost teeth of the image compared to our method.

Quantitative measurement is impossible since there is no ground truth, but compared to the results of the existing methods, it can be seen that the tooth regions are neatly segmented. In particular, only the tooth regions are segmented in the teeth images where the lips and the face part exist.

% Figure: Edge region candidate and results
\input{ ./Figures/results/fig.tex}

% Section: Conclusion
\section{Conclusion}
\label{Sec:Conclusion}

In this paper, we proposed a method for individual tooth segmentation in a human teeth image. Including the strong light reflection, there are several obstacles that hinder the segmentation process. We solved these problems by obtaining pseudo edge-region using a deep neural network with supervised learning. In the labeling process, model-based methods were used to reduce time consumption and cost. In addition, we proposed contour evolutions to acquire initial contours from the pseudo edge-region and then to find the boundary of the tooth using different forces depending on the situation. Finally, by identifying tooth and non-tooth regions from the segmented result, we achieved the individual tooth segmentation in a human teeth image. 

Among the existing methods, model-based methods show insufficient performance. The supervised learning methods using Mask R--CNN have similar performance to ours but, it is difficult to label the data for training. This work is significant in that it proposed an algorithm that can easily prepare training data while producing good performance through a combination of model-based methods and a supervised learning method. It is noted that such combination produced a synergy effect; model-based methods streamline the labeling process for training deep neural networks, and the networks simplify the problem by inferring edge-regions. 

Individual tooth segmentation can be used importantly for 3D teeth model reconstruction and dental forensics applications. We hope that this study will be of great help in reconstructing more sophisticated 3D teeth models from 2D teeth images and also constructing more effective dental forensic systems.

% Section: Acknowledgement
% \section*{Acknowledgement}

%% Appendix
\appendix
\section{Structure of neural network}
\label{App:neural_net}

In this appendix, the structure of the neural network used in Section~\ref{Subsec:pseudo_er} is presented in Figure~\ref{Fig:network}. For the encoder part of neural network, the feature extraction part of ResNeSt-50~\cite{Zhang:2020:ResNeSt} was used, and the upscaling decoder part was designed.

% Figure: Network structure
\input{./TeethSeg_network.tex}

%% References
\bibliographystyle{siam}
\bibliography{bibliography}

\end{document}
